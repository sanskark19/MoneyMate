@page "/adddebts"
@inject NavigationManager NavigationManager
@inject DatabaseService.Services.dbDebt DebtService
@using Coursework.Models

<div class="transaction-container d-flex justify-content-center align-items-center vh-100 p-4" style="background-color: #96BCD4; max-width: 100%; border-radius: 10px;">
    <div class="card border-0 shadow-sm" style="background-color: #E1EBEE; border-radius: 10px; padding: 20px; width: 100%; max-width: 500px;">
        <h1 class="h2 mb-0 fw-bold text-black text-center">Add Debt</h1>

        <div class="card-body">
            <EditForm Model="@_debt" OnValidSubmit="OnValidSubmit">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <!-- Debt Title -->
                <div class="mb-4">
                    <label for="DebtTitle" class="form-label fw-medium">Debt Title</label>
                    <InputText id="DebtTitle" class="form-control" @bind-Value="_debt.Source" />
                    <ValidationMessage For="@(() => _debt.Source)" />
                </div>

                <!-- Debt Amount -->
                <div class="mb-4">
                    <label for="amount" class="form-label fw-medium">Debt Amount</label>
                    <InputNumber id="amount" class="form-control" @bind-Value="_debt.Amount" />
                    <ValidationMessage For="@(() => _debt.Amount)" />
                </div>
                
                <!-- Source -->
                <div class="mb-4">
                    <label for="Source" class="form-label fw-medium">Source (Optional)</label>
                    <InputText id="Source" class="form-control" @bind-Value="_debt.Source" />
                    <ValidationMessage For="@(() => _debt.Source)" />
                </div>
                
                <!-- Due Date -->
                <div class="mb-4">
                    <label for="dueDate" class="form-label fw-medium">Due Date</label>
                    <InputDate id="dueDate" class="form-control" @bind-Value="_debt.DueDate" />
                    <ValidationMessage For="@(() => _debt.DueDate)" />
                </div>

                <!-- Buttons -->
                <div class="d-grid gap-3 d-md-flex justify-content-md-end mt-4">
                    <button type="submit" class="btn btn-primary me-md-2 px-4">Add Debt</button>
                    <button type="button" class="btn btn-outline-secondary px-4" @onclick="ResetForm">Reset</button>
                </div>
            </EditForm>

            <!-- Status Message -->
            @if (!string.IsNullOrEmpty(_statusMessage))
            {
                <div class="mt-4 alert @(_statusMessage.Contains("error") ? "alert-danger" : "alert-success")">
                    @_statusMessage
                </div>
            }
        </div>
    </div>
</div>

@code {
    private Debts _debt = new Debts
    {
        Source = String.Empty,
        Amount = 0,
        DueDate = DateTime.Now
    };
    private string _statusMessage = string.Empty;

    private async Task OnValidSubmit()
    {
        try
        {
            var success = await DebtService.SaveDebtsAsync(_debt);
            _statusMessage = success ? "Debt added successfully!" : "An error occurred while adding the debt.";
            if (success)
                NavigationManager.NavigateTo("/transaction");
        }
        catch (Exception ex)
        {
            _statusMessage = $"An error occurred: {ex.Message}";
        }
    }

    private void ResetForm()
    {
        _debt = new Debts
        {
            Source = String.Empty,
            Amount = 0,
            DueDate = DateTime.Now
        };
        _statusMessage = string.Empty;
    }
}
